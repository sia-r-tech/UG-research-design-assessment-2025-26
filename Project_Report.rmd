---
title: "Group project assessment [template]"
author: '[update with group members'' exam numbers]'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

NOTE: Please don't edit this template directly. Use `File` > `Save as` to create a copy of this document, rename it (remove the word "template" from the file name) and use that new version to write your report. Make sure to also update the Title and Author fields in the YAML of your .Rmd file.

## Task 1: Reproducing and improving figures

```{r load-wrangle}
# load and wrangle the data here


```


### Figure 3
```{r figure-3}
# Write your code for reproducing, and then improving Figure 3. Present both figures together. Under the figures, explain how you've improved Figure 3 and why you consider this an improvement.
```


### Figure 4
```{r figure-4}
# Write your code for reproducing, and then improving Figure 4. Present both figures together. Under the figures, explain how you've improved Figure 3 and why you consider this an improvement.

install.packages(c("tidyverse", "readxl", "janitor", "dplyr", "ggrepel"))

library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(readr)
library(here)
library(ggrepel)


HIIT_post <- readr::read_csv(
  here::here("data", "HIIT-postpartum-depression.csv"),
  na = c("", "NA", "#NULL!"),
  show_col_types = FALSE
) %>%
  janitor::clean_names()



fs_long <- HIIT_post %>%
  mutate(
    group = case_when(
      intervention_group == 1 ~ "HIIT",
      intervention_group == 2 ~ "EDU",
      TRUE ~ as.character(intervention_group)
    )
  ) %>%
  select(group, pre_fs_scale, post_fs_score, postnatal_florishing_scale_score) %>%
  pivot_longer(
    cols = c(pre_fs_scale, post_fs_score, postnatal_florishing_scale_score),
    names_to = "time",
    values_to = "fs"
  ) %>%
  mutate(
    time = factor(
      time,
      levels = c("pre_fs_scale", "post_fs_score", "postnatal_florishing_scale_score"),
      labels = c(
        "Before the intervention\n(II trimester of pregnancy)",
        "After the intervention\n(III trimester of pregnancy)",
        "Follow-up\n(± 5 months postpartum)"
      )
    ),
    fs = as.numeric(fs)
  ) %>%
  filter(!is.na(fs), group %in% c("HIIT", "EDU"))

#Now computing Mean (M) and SD per group/time for figure 4 
fs_sum <- fs_long %>%
  group_by(group, time) %>%
  summarise(
    n = n(),
    mean = mean(fs),
    sd = sd(fs),
    .groups = "drop"
  ) %>%
  mutate(
    label = sprintf("M = %.2f", mean)
  )

#Labels and Line Spacing 
 fs_sum <- fs_sum %>%
  mutate(
    label_nudge = case_when(
      group == "HIIT" & time == "After the intervention\n(III trimester of pregnancy)" ~ 1.1,
      group == "EDU"  & time == "After the intervention\n(III trimester of pregnancy)" ~ -1.1,
      group == "HIIT" ~ 0.7,
      group == "EDU"  ~ -0.7
    )
  )
 
 #Plot for Figure 4 
p <- ggplot(fs_sum, aes(x = time, y = mean, group = group, linetype = group)) +
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08,
    linewidth = 0.6
  ) +
  geom_line(linewidth = 0.9) +
  geom_point(size = 2.2) +
  
  geom_text(
  aes(label = label, y = mean + label_nudge),
    nudge_x = 0.12,
  size = 3.2
) +

  scale_linetype_manual(
    values = c("HIIT" = "solid", "EDU" = "dotted"),
    labels = c("HIIT" = "HIIT – High Intensity Interval Training Group",
               "EDU" = "EDU – Educational Intervention Group")
  ) +
 scale_y_continuous(
    limits = c(40, 60),
    breaks = seq(40, 60, 2),
      labels = function(x) sprintf("%.2f", x)
  ) +
  labs(
    x = NULL,
    y = NULL,
    linetype = NULL
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank()
  )

p

```

### Improvement Figure 4

```{r}

pd <- position_dodge(width = 0.18) # reproducible spacing between groups

p <- ggplot(fs_sum, aes(x = time, y = mean, group = group)) +
  
  # SD error bars: force SOLID line so they don't become dotted for EDU
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08,
    linewidth = 0.6,
    linetype = "solid",
    position = pd
  ) +

  # Mean line: make it visually distinct (colour + linetype)
  geom_line(
    aes(linetype = group, colour = group),
    linewidth = 1.1,
    position = pd
  ) +

  # Mean points: also dodged so they don't overlap
  geom_point(
    aes(colour = group),
    size = 2.4,
    position = pd
  ) +

  ggrepel::geom_text_repel(
  aes(label = label),
  nudge_x = 0.35,          # keep pushing right
  nudge_y = 0.6,           # push labels slightly upward (helps left/middle)
  direction = "y",         # only adjust vertically after nudging
  box.padding = 0.4,       # more space around labels
  point.padding = 0.35,    # keep away from points/lines
  force = 2,               # stronger repulsion
  max.overlaps = Inf,
  segment.size = 0.2,
  size = 3.2,
  seed = 1
) +

  
  # Group line style (mean line)
  scale_linetype_manual(
    values = c("HIIT" = "solid", "EDU" = "dotted"),
    labels = c(
      "HIIT" = "HIIT – High Intensity Interval Training Group",
      "EDU"  = "EDU – Educational Intervention Group"
    )
  ) +

  # Colour legend matches groups (mean line + points)
  scale_colour_manual(
    values = c("HIIT" = "black", "EDU" = "grey40"),
    labels = c(
      "HIIT" = "HIIT – High Intensity Interval Training Group",
      "EDU"  = "EDU – Educational Intervention Group"
    )
  ) +

  scale_y_continuous(
    limits = c(40, 60),
    breaks = seq(40, 60, 2),
    labels = function(x) sprintf("%.2f", x)
  ) +

  labs(
    x = NULL,
    y = "Flourishing Scale (Mean ± SD)",
    linetype = NULL,
    colour = NULL,
    caption = "HIIT and EDU are similar pre/post, but HIIT maintains higher flourishing at follow-up."
  ) +

 theme_minimal(base_size = 12) +
theme(
  legend.position = "bottom",
  panel.grid.minor = element_blank(),
  axis.line = element_line(colour = "black", linewidth = 0.6)
)


p

```



### Figure 5
```{r figure-5}
# Write your code for reproducing, and then improving Figure 5. Present both figures together. Under the figures, explain how you've improved Figure 5 and why you consider this an improvement.
```


## Task 2: FAIR data principles

## Task 3: Reproducibility brief

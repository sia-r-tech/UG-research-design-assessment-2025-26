---
title: "Group project assessment [template]"
author: '[update with group members'' exam numbers]'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

NOTE: Please don't edit this template directly. Use `File` > `Save as` to create a copy of this document, rename it (remove the word "template" from the file name) and use that new version to write your report. Make sure to also update the Title and Author fields in the YAML of your .Rmd file.

## Task 1: Reproducing and improving figures

```{r load-wrangle}
# load and wrangle the data here


```





### Figure 4
```{r figure-4-1}
# Write your code for reproducing, and then improving Figure 4. Present both figures together. Under the figures, explain how you've improved Figure 3 and why you consider this an improvement.


library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(readr)
library(here)
library(ggrepel)


HIIT_post <- readr::read_csv(
  here::here("data", "HIIT-postpartum-depression.csv"),
  na = c("", "NA", "#NULL!"),
  show_col_types = FALSE
) %>%
  janitor::clean_names()


HIIT_complete <- HIIT_post %>%
  filter(
    !is.na(pre_fs_scale),
    !is.na(post_fs_score),
    !is.na(postnatal_florishing_scale_score)
  )

fs_long <- HIIT_complete %>%
  mutate(
    group = case_when(
      intervention_group == 1 ~ "HIIT",
      intervention_group == 2 ~ "EDU"
    ),
    group = factor(group, levels = c("HIIT", "EDU"))
  ) %>%
  select(group, pre_fs_scale, post_fs_score, postnatal_florishing_scale_score) %>%
  pivot_longer(
    cols = -group,
    names_to = "time",
    values_to = "fs"
  ) %>%
  mutate(
    time = factor(
      time,
      levels = c("pre_fs_scale", "post_fs_score", "postnatal_florishing_scale_score"),
      labels = c(
        "Before the intervention\n(II trimester of pregnancy)",
        "After the intervention\n(III trimester of pregnancy)",
        "Follow-up\n(± 5 months postpartum)"
      )
    )
  )

fs_sum <- fs_long %>%
  group_by(group, time) %>%
  summarise(
    n = n(),
    mean = mean(fs),
    sd = sd(fs),
    .groups = "drop"
  )


#Now computing Mean (M) and SD per group/time for figure 4 
fs_sum <- fs_long %>%
  group_by(group, time) %>%
  summarise(
    n = n(),
    mean = mean(fs),
    sd = sd(fs),
    .groups = "drop"
  ) %>%
  mutate(
    label = sprintf("M = %.2f", mean)
  )
```


```{r figure-4-plot}
fs_sum <- fs_sum %>%
  mutate(label = sprintf("M = %.2f", mean)) %>%
  mutate(
    label_y = case_when(
      group == "HIIT" & grepl("^After", time) ~ 0.9,
      group == "EDU"  & grepl("^After", time) ~ -0.9,
      group == "HIIT" ~ 0.7,
      group == "EDU"  ~ -0.7
    ),
    label_x = case_when(
      grepl("^Before", time) ~ -0.18,
      grepl("^After",  time) ~  0.00,
      grepl("^Follow", time) ~  0.18
    ),
    label_hjust = case_when(
      grepl("^Before", time) ~ 1,
      grepl("^After",  time) ~ 0.5,
      grepl("^Follow", time) ~ 0
    )
  )


fig4 <- ggplot(fs_sum, aes(x = time, y = mean, group = group, linetype = group)) +

  # SD error bars: grey + SOLID, not affected by group linetype
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.04,
    linewidth = 0.50,
    colour = "grey40",
    alpha = 0.75,
    linetype = "solid"
  ) +

  # Mean lines (black)
  geom_line(linewidth = 1.0, colour = "black") +

  # Mean labels (custom x shift + vertical shift)
  geom_text(
    aes(
      label = label,
      y = mean + label_y,
      x = as.numeric(time) + label_x,
      hjust = label_hjust
    ),
    size = 3.2
  ) +

  scale_linetype_manual(
    values = c("HIIT" = "solid", "EDU" = "11"),
    labels = c("HIIT" = "HIIT – High Intensity Interval Training Group",
               "EDU"  = "EDU – Educational Intervention Group")
  ) +

  scale_y_continuous(
    limits = c(40, 60),
    breaks = seq(40, 60, 2),
    labels = function(x) sprintf("%.2f", x),
    expand = c(0, 0)
  ) +

  labs(
    caption = paste("FIGURE 4  Between-group differences in psychological well-being. Note. The figure shows standard deviation (SD) bars."),
    x = expression(bold("Psychological well-being") * " " * italic("(measured with the Flourishing Scale)")),
    y = NULL,
    linetype = NULL
  ) +

  theme_bw(base_size = 12) +
  theme(
    legend.position = "bottom",
    legend.box = "vertical",
    plot.caption = element_text(hjust = 0, margin = margin(t = 8)),
    plot.margin = margin(t = 8, r = 12, b = 18, l = 12),
    axis.ticks = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_line(colour = "grey85", linewidth = 0.6),
    panel.grid.major.x = element_blank(),   # mostly horizontal gridlines like the original
    panel.border = element_rect(colour = "grey60", linewidth = 0.8)
    ) +
  guides(
  linetype = guide_legend(nrow = 2, byrow = TRUE)
  )

fig4

```

```{r figure-4-improved}
library(grid)
library(ggrepel)

pd <- position_dodge(width = 0.20)

# Make labels group specific
fs_sum <- fs_sum %>%
  mutate(
    label = paste0(group, ": ", sprintf("%.2f", mean)),

    # Baseline: put EDU above HIIT
    label_y = case_when(
      grepl("^Before", time) & group == "HIIT" ~ 0.3,
      grepl("^Before", time) & group == "EDU"  ~ 0.5,

      # keep the rest
      group == "HIIT" & grepl("^After", time)  ~ 0.5,
      group == "EDU"  & grepl("^After", time)  ~ 0.0,
      group == "HIIT" ~ -0.5,
      group == "EDU"  ~ -0.7
    )
  )


fig4_imp <- ggplot(fs_sum, aes(x = time, y = mean, group = group, linetype = group)) +
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08,
    linewidth = 0.65,
    colour = "grey60",
    linetype = "solid",
    position = pd
  ) +
  geom_line(aes(linewidth = group), colour = "black", position = pd) +
  scale_linewidth_manual(values = c("HIIT" = 1.05, "EDU" = 0.9), guide = "none") +
  
  geom_point(
  aes(fill = group),
  position = pd,
  size = 2.6,
  shape = 21,        # allows fill + outline
  colour = "black",
  stroke = 0.6
  )+
  scale_fill_manual(
  values = c("HIIT" = "black", "EDU" = "white"),
  guide = "none"   # we’ll control the legend manually below
  )+

  geom_text(
  data = fs_sum %>% filter(group == "HIIT"),
  aes(x = time, y = mean + label_y, label = label),
  nudge_x = -0.27,
  size = 3.2
  ) +

  geom_text(
  data = fs_sum %>% filter(group == "EDU"),
  aes(x = time, y = mean + label_y, label = label),
  nudge_x = 0.27,
  size = 3.2
  )+


  scale_linetype_manual(
  values = c("HIIT" = "solid", "EDU" = "11"),
  breaks = c("HIIT", "EDU"),
  labels = c(
    "HIIT - High Intensity Interval Training Group (left; filled points)",
    "EDU - Educational Intervention Group (right; open points)")
  ) +

  scale_y_continuous(
    limits = c(40, 58),
    breaks = seq(40, 58, 2),
    labels = \(x) sprintf("%.2f", x),
    expand = expansion(mult = c(0, 0))
  ) +

  labs(
  title = "FIGURE 4  Between-group differences in psychological well-being",
  subtitle = "Measured with the Flourishing Scale across pregnancy and postpartum",
  x = NULL,
  y = "Flourishing Scale score\n(higher = better psychological well-being)",
  linetype = NULL
  )+

  theme_bw(base_size = 12) +
  theme(
    plot.title = element_text(face = "bold", size = 12, hjust = 0),
    plot.subtitle = element_text(size = 10, hjust = 0, margin = margin(b = 8)),
    plot.title.position = "plot",
    panel.grid.major.y = element_line(linewidth = 0.4, colour = "grey85"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "grey60", linewidth = 0.8),
    axis.title.x = element_text(face = "bold", margin = margin(t = 8)),
    legend.position = "bottom",
    legend.key.width = unit(2.3, "cm"),
    legend.spacing.x = unit(0.6, "cm")
  ) +
  guides(
  linetype = guide_legend(
    nrow = 2,
    byrow = TRUE,
    override.aes = list(
      shape = 21,
      fill  = c("black", "white"),
      colour = "black",
      size = 3)
  )
)

fig4
fig4_imp
```

## Explanation of Improvements 
The new graph improves readability by dodging the two groups slightly using the "position_dodge" function. By doing this, it prevents the standard deviation error bars from overlapping, making interpretation easier. We also made the group identity clearer by creating filled and open points (HIIT-filled points, EDU-open points). The mean labels are  moved to avoid collisions. We also replaced hard-coded texts with complete case data and set a fixed random seed. The seed iterations so that any automatic label placement is identical each time the code is run. This allows the figure to be reproduced exactly across different computers and runs.


### Figure 5
```{r figure-5}
# Write your code for reproducing, and then improving Figure 5. Present both figures together. Under the figures, explain how you've improved Figure 5 and why you consider this an improvement.
```


## Task 2: FAIR data principles

## Task 3: Reproducibility brief

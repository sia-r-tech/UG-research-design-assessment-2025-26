---
title: "Group project assessment [template]"
author: '[update with group members'' exam numbers]'
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

NOTE: Please don't edit this template directly. Use `File` > `Save as` to create a copy of this document, rename it (remove the word "template" from the file name) and use that new version to write your report. Make sure to also update the Title and Author fields in the YAML of your .Rmd file.

## Task 1: Reproducing and improving figures

```{r load-wrangle}
# load and wrangle the data here


```


### Figure 3
```{r figure-3}
# Write your code for reproducing, and then improving Figure 3. Present both figures together. Under the figures, explain how you've improved Figure 3 and why you consider this an improvement.
```


### Figure 4
```{r figure-4}
# Write your code for reproducing, and then improving Figure 4. Present both figures together. Under the figures, explain how you've improved Figure 3 and why you consider this an improvement.

install.packages(c("tidyverse", "readxl", "janitor", "dplyr", "ggrepel"))

library(tidyverse)
library(readxl)
library(janitor)
library(dplyr)
library(readr)
library(here)
library(ggrepel)


HIIT_post <- readr::read_csv(
  here::here("data", "HIIT-postpartum-depression.csv"),
  na = c("", "NA", "#NULL!"),
  show_col_types = FALSE
) %>%
  janitor::clean_names()


HIIT_complete <- HIIT_post %>%
  filter(
    !is.na(pre_fs_scale),
    !is.na(post_fs_score),
    !is.na(postnatal_florishing_scale_score)
  )

fs_long <- HIIT_complete %>%
  mutate(
    group = case_when(
      intervention_group == 1 ~ "HIIT",
      intervention_group == 2 ~ "EDU"
    )
  ) %>%
  select(group, pre_fs_scale, post_fs_score, postnatal_florishing_scale_score) %>%
  pivot_longer(
    cols = -group,
    names_to = "time",
    values_to = "fs"
  ) %>%
  mutate(
    time = factor(
      time,
      levels = c("pre_fs_scale", "post_fs_score", "postnatal_florishing_scale_score"),
      labels = c(
        "Before the intervention\n(II trimester of pregnancy)",
        "After the intervention\n(III trimester of pregnancy)",
        "Follow-up\n(± 5 months postpartum)"
      )
    )
  )

fs_sum <- fs_long %>%
  group_by(group, time) %>%
  summarise(
    n = n(),
    mean = mean(fs),
    sd = sd(fs),
    .groups = "drop"
  )


#Now computing Mean (M) and SD per group/time for figure 4 
fs_sum <- fs_long %>%
  group_by(group, time) %>%
  summarise(
    n = n(),
    mean = mean(fs),
    sd = sd(fs),
    .groups = "drop"
  ) %>%
  mutate(
    label = sprintf("M = %.2f", mean)
  )
```


```{r figure-4}
#Double Checking and Fixing Mean Calculations 
fs_sum %>% arrange(time, group) %>% select(group, time, n, mean, sd)

fs_sum %>%
  arrange(time, group) %>%
  transmute(time, group, n, mean = round(mean, 2), sd = round(sd, 2))

names(HIIT_post)

HIIT_post %>%
  select(intervention_group, pre_fs_scale, post_fs_score, postnatal_florishing_scale_score) %>%
  glimpse()

HIIT_post %>% count(intervention_group)


summary(HIIT_post$pre_fs_scale)
summary(HIIT_post$post_fs_score)
summary(HIIT_post$postnatal_florishing_scale_score)


```


```{r}
fs_sum <- fs_sum %>%
  mutate(label = sprintf("M = %.2f", mean)) %>%
  mutate(
    label_y = case_when(
      group == "HIIT" & grepl("^After", time) ~ 0.9,
      group == "EDU"  & grepl("^After", time) ~ -0.9,
      group == "HIIT" ~ 0.7,
      group == "EDU"  ~ -0.7
    ),
    label_x = case_when(
      grepl("^Before", time) ~ -0.18,
      grepl("^After",  time) ~  0.00,
      grepl("^Follow", time) ~  0.18
    ),
    label_hjust = case_when(
      grepl("^Before", time) ~ 1,
      grepl("^After",  time) ~ 0.5,
      grepl("^Follow", time) ~ 0
    )
  )


p <- ggplot(fs_sum, aes(x = time, y = mean, group = group, linetype = group)) +

  # SD error bars: grey + SOLID, not affected by group linetype
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08,
    linewidth = 0.6,
    colour = "grey55",
    linetype = "solid"
  ) +

  # Mean lines (black)
  geom_line(linewidth = 1.0, colour = "black") +

  # Mean labels (custom x shift + vertical shift)
  geom_text(
    aes(
      label = label,
      y = mean + label_y,
      x = as.numeric(time) + label_x,
      hjust = label_hjust
    ),
    size = 3.2
  ) +

  scale_linetype_manual(
    values = c("HIIT" = "solid", "EDU" = "dotted"),
    labels = c("HIIT" = "HIIT – High Intensity Interval Training Group",
               "EDU"  = "EDU – Educational Intervention Group")
  ) +

  scale_y_continuous(
    limits = c(40, 60),
    breaks = seq(40, 60, 2),
    labels = function(x) sprintf("%.2f", x)
  ) +

  labs(
    x = "Psychological well-being (measured with the Flourishing Scale)",
    y = NULL,
    linetype = NULL
  ) +

  theme_bw(base_size = 12) +
  theme(
    legend.position = "bottom",
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),   # mostly horizontal gridlines like the original
    panel.border = element_rect(colour = "grey60", linewidth = 0.8)
  )

p

```


### Improvement Figure 4

```{r}
library(grid)
library(ggrepel)

pd <- position_dodge(width = 0.18)

p <- ggplot(fs_sum, aes(x = time, y = mean, group = group, linetype = group)) +
  geom_errorbar(
    aes(ymin = mean - sd, ymax = mean + sd),
    width = 0.08,
    linewidth = 0.65,
    colour = "grey60",
    linetype = "solid",
    position = pd
  ) +
  geom_line(aes(linewidth = group), colour = "black", position = pd) +
  scale_linewidth_manual(values = c("HIIT" = 1.05, "EDU" = 0.9), guide = "none") + #HIIT line slightly thicker than EDU so it is easier to read

  geom_text_repel(
    aes(
      label = label,
      y = mean + label_y,
      x = as.numeric(time_key) + label_x
    ),
    size = 3.2,
    direction = "y",
    box.padding = 0.15,
    point.padding = 0.2,
    min.segment.length = 0,
    segment.size = 0,
    seed = 123 # makes placement reproducible
  ) +

  scale_linetype_manual(
    values = c("HIIT" = "solid", "EDU" = "dotted"),
    breaks = c("HIIT", "EDU"),
    labels = c(
      "HIIT" = "HIIT – High Intensity Interval Training Group",
      "EDU"  = "EDU – Educational Intervention Group"
    )
  ) +

  scale_y_continuous(
    limits = c(40, 60),
    breaks = seq(40, 60, 2),
    labels = \(x) sprintf("%.2f", x),
    expand = expansion(mult = c(0, 0))
  ) +

  labs(
    x = "Psychological well-being (measured with the Flourishing Scale)",
    y = NULL,
    linetype = NULL
  ) +

  theme_bw(base_size = 12) +
  theme(
    panel.grid.major.y = element_line(linewidth = 0.4, colour = "grey85"),
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(colour = "grey60", linewidth = 0.8),
    axis.title.x = element_text(face = "bold", margin = margin(t = 8)),
    legend.position = "bottom",
    legend.key.width = unit(2.3, "cm"),
    legend.spacing.x = unit(0.6, "cm")
  ) +
  guides(linetype = guide_legend(nrow = 1, byrow = TRUE))

p
```
## Explanation of Improvements 
The improved graph is easier to read and more reproducible. The two groups are now slightly separated at each time point, preventing the standard deviation (SD) error bars from overlapping. This makes it easier to interpret. Mean labels are also positioned more consistently, reducing visual clutter. Duplicated calculations and hard-coded text have been removed and replaced with complete case data. In addition, setting a fixed random seed ensures that any automatic label placement is identical each time the code is ran. This allows the figure to be reproduced exactly across different computers and runs.


### Figure 5
```{r figure-5}
# Write your code for reproducing, and then improving Figure 5. Present both figures together. Under the figures, explain how you've improved Figure 5 and why you consider this an improvement.
```


## Task 2: FAIR data principles

## Task 3: Reproducibility brief
